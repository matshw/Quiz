<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="login-container">
        <h1>Login</h1>
        <input type="text" id="username" placeholder="Digite seu nome">
        <button onclick="login()">Entrar</button>
        <p id="error-message"></p>
    </div>

    <div id="quiz-container" style="display: none;">
        <h1>Quiz</h1>
        <p id="bem-vindo"></p>
        <p id="questao"></p>
        <ul id="opcoes"></ul>
        <p id="pontuacao">Pontuação: 0</p>
        <p id="nivel">Nível: 1</p>
    </div>

    <div id="end-container" style="display: none;">
        <h2>Quiz concluído!</h2>
        <p id="pontuacao-final"></p>
        <button onclick="reiniciar()">Reiniciar</button>
    </div>

    <script>
        const ws = new WebSocket('ws://localhost:8080');
    let questaoAtual = null;
    let nivel = 0;

    ws.onopen = () => {
        console.log('Usuário conectou no servidor');
    };

    ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        if (data.type === 'bemvindo') {
            document.getElementById('bem-vindo').textContent = data.message;
        } else if (data.type === 'error') {
            document.getElementById('error-message').textContent = data.message;
        } else if (data.type === 'questao') {
            document.getElementById('quiz-container').style.display = 'block';
            document.getElementById('login-container').style.display = 'none';
            questaoAtual = data.questao;
            displayQuestion(data.questao);
            document.getElementById('nivel').textContent = 'Nível: ' + (nivel + 1);
            document.getElementById('pontuacao').textContent = 'Pontuação: ' + (data.pontuacao !== undefined ? data.pontuacao : 0);
            document.getElementById('end-container').style.display = 'none';
            nivel++;
        } else if (data.type === 'end') {
            final(data.pontuacao);
        }
    };

    ws.onclose = () => {
        console.log('Usuário desconectou do servidor');
    };

    function login() {
        const username = document.getElementById('username').value;
        ws.send(JSON.stringify({ type: 'login', username: username }));
    }

        function displayQuestion(questao) {
            document.getElementById('questao').textContent = questao.questao;
            const listaOpcoes = document.getElementById('opcoes');
            listaOpcoes.innerHTML = '';
            questao.opcoes.forEach(option => {
                const li = document.createElement('li');
                const button = document.createElement('button');
                button.textContent = option;
                button.onclick = () => enviarResposta(option);
                li.appendChild(button);
                listaOpcoes.appendChild(li);
            });
        }

        function enviarResposta(resposta) {
            ws.send(JSON.stringify({ type: 'resposta', resposta: resposta }));
        }

        function final(pontuacao) {
            document.getElementById('quiz-container').style.display = 'none';
            document.getElementById('end-container').style.display = 'block';
            document.getElementById('pontuacao-final').textContent = 'Pontuação final: ' + pontuacao;
        }

        function reiniciar() {
            window.location.reload();
        }
    </script>
</body>
</html>
